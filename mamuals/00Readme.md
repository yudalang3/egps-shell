# eGPS 2.1 的模块化设计与开发实践



>
> > **欢迎来到 eGPS 模块说明书！**，内含软件的设计理念与开发教程
>
> 本教程将引导你从零开始学习 eGPS 这些模块是如何设计出来，它产生的背景与演变的过程。
>
> 以及如何为 eGPS 开发自定义模块和插件。
> 无论你是想快速创建一个简单工具，还是开发复杂的分析模块，这里都有完整的指导。


我们将从要解决的问题出发，逐步讲解 eGPS 从第一代演进到第二代，以及从 2.0 更新到 2.1 的转变。

这里不仅记录“做了什么”，更想回答“为什么要这样做”：当科研软件从个人工具变成团队长期维护的平台时，哪些痛点是共性的、可抽象的？又该用怎样的框架把这些痛点一次性解决？

详情可查看我们遗传杂志的综述：https://www.chinagene.cn/CN/10.16288/j.yczz.24-254

**重大更新说明**：
- ✅ `eGPS 1 -> eGPS 2`: 主要是 1) 模块化；2) GUI 界面有了显著的视觉优化；3) 提出 VOICE 模块运行方式的通用模式
- ✅ `eGPS 2.0 -> eGPS 2.1`: 从“核心算法与数据结构都需要自己从零实现”，转为“可以依赖成熟的第三方库，把精力放在方法整合与可用性上”

---

## 30 秒先理解：这是什么？为什么要用？

**这是什么**：一个面向科研场景的“模块化桌面分析平台框架”。每个分析能力以“模块”的形式存在，模块遵循统一的声明与运行方式，可以作为内置功能，也可以作为外部插件进行分发与安装。

**为什么要用**：对科研软件来说，真正的成本往往不是写出一次能用的分析，而是让工具在多人协作、长期迭代、不断新增分析方法时仍然**可维护、可复现、可扩展**。模块化框架的价值在于：把“接入主程序、统一交互、安装分发、插件扩展”这些重复劳动前置成规则，让你把精力放回到数据与方法本身。

---

## 1. 我们要解决什么问题

如果你曾经维护过一个不断增长的桌面软件，你大概率见过这种局面：

- 功能越做越多，主工程越来越像“巨石应用”，改一处牵一片
- 新功能要接入菜单、工具栏、窗口管理、参数保存、导入导出……每次都要重复造轮子
- 团队协作时缺少清晰边界：谁都能在主窗体里加按钮、加线程、读写文件，最后变成“能跑就行”
- 想支持外部扩展（插件），却发现类加载、版本冲突、模块发现、用户安装路径，全都要从头设计

eGPS 诞生于生物信息学软件的实践，但它真正沉淀下来的，是一套可复用的**通用桌面平台骨架**：用“模块契约 + 统一入口 + 自动发现 + 插件隔离”的方式，把复杂桌面应用拆解成可管理、可扩展、可分发的模块体系。

---

我们期望编写一个通用型的生物数据分析平台，以演化生物学为主要的应用领域，其它多组学的分析也能进行。

不但能吸引使用人员（命令行使用与 GUI 使用），而且吸引开发人员。这不是一个具体的针对某个领域的软件，它是一个通用的软件平台。

更具体一点：当你面对“不断增长的分析需求”时，真正棘手的不是某一个算法，而是**如何组织和交付一组不断增长的工具**：
- 让用户能快速找到工具、理解输入输出、复现一次分析
- 让开发者能用一致方式接入新工具，而不是不断修改主工程
- 让工具能以插件形式分发给同事或用户，降低安装与升级的摩擦

---

## 2. 有哪些具体的需求，从用法上看有哪些模块

我们的目的不仅仅是做一个第三方库，可以命令行使用。而且主要是为了吸引 `非编程用户`，所以我们希望模块的通用性足够高。

现在需求量最大的有跨物种进化生物学领域的 `基因家族聚类分析`，转录组学的 `差异表达基因和富集分析`。我们的**最终目的**就是构建直接可用的分析流程。

（P.S. 当然这少不了具体的生态建设，以及更多人的努力）

**从用法上看**，有两大类模块：命令行模块和 GUI 模块。顾名思义，命令行就是在终端下使用的模块；而 GUI 模块打开之后便有一个可视化界面，可以供用户操作。

> 根据软件 2.1 版本的理念，我们并不想*造轮子*。然而，对于软件工程而言，软件的体积与打包的容易程度也是一个考量目标。

- 一个大而全的软件，必然会导致其臃肿不堪，而且开发人员精力有限，我们优先编写最终用户需要的可视化模块。
- 对于生物学家而言，大部分精力不会花在这上面，最能提高效率的就是 GUI 模块。

---

## 3. 何为通用，模块的共性是什么，GUI 模块的共性

> 反之：如果没有共性，那么想要解决一个问题，直接用原生编程语言提供的工具包写不就行了吗？为何需要 eGPS 呢？  
> （对于用户而言，我想要处理某个任务，比如需要 10 个专业工具，我直接去下载 10 个专业的工具用不就行了吗？）  
> 答：我们需要一个共性的设计理念，我们需要一个统一机制。这样最终就能给予用户一个统一的软件体验，给予开发人员统一的模块开发体验。

根据我们对生物数据分析过程的理解，软件不外乎以下的共性操作流程：

1. 获取数据
2. 导入数据
3. 配置参数
4. 点击运行
5. 导出结果

软件分析流程，本质上是在把很多模块“首尾相连”。因此我们更需要一个统一的软件平台和统一的模块运行框架。

对于使用人员和开发人员的影响如下：
- 用户具有一致的使用体验（知道去哪里找功能、怎么输入、怎么导出、怎么查看帮助）
- 开发人员具有一致的模块开发体验（知道模块需要提供哪些信息与能力）

> GUI 模块虽然相对于命令行模块而言，上手成本更低，但如果不同模块交互方式完全不同，用户仍然需要付出显著的学习成本。

因此，`eGPS 2.1` 的主要目的在于：提出一种通用型的软件模块架构，让其能够适应（并约束）生物数据分析过程。

从“交互共性”的角度看，GUI 模块通常需要具备：

1. 有地方可以提前知道模块有什么功能（入口与简介）
2. 有输入/导入数据的统一规范（减少格式与路径带来的反复试错）
3. 有参数配置的统一入口（让参数可追踪、可复现）
4. 有运行的统一方式（让耗时任务与界面响应不互相影响）
5. 有导出结果的统一步骤（让结果能被复用与共享）
6. 有快速使用简介与规范（降低学习成本）
7. 清楚“模块怎么打开/怎么关闭/打开了哪些”（避免窗口或标签过多导致迷失）

一个重要的原则：所有输入数据与参数尽量处于可见且可管理的位置，这样才有利于结果的可重复性。

---

## 4. 模块的通用框架应该被如何设计

如果没有一定的设计目标，最终出来的东西肯定 `大而无当`，容易出现“大杂烩”与“一锅炖”。我们必须要有明确的软件目标与边界：

- 软件必须要本地化，用户可以免费无限制获得与使用。
- 所有模块应该遵循共同的标准规范（让模块可替换、可比较、可组合）。
- GUI 模块的通用型设计应尽量简单：减少开发者负担，降低用户学习成本。

从框架抽象上看，我们希望把系统拆成三件事：

1. **主框架负责一致性**：提供统一入口、统一的模块管理与通用交互。
2. **模块负责业务**：每个模块只关注自己的方法与界面，不把逻辑散落进主框架。
3. **扩展机制负责演进**：允许以插件形式添加新模块，让新增能力更像“添加一个独立单元”，而不是“修改主程序很多地方”。

根据生物数据分析分析流程，每个模块必须要有一个统一入口，整个分析过程可以简化为如下步骤：

- Open Module
- Input Data and Parameters
- Click Run
- Execute

所以我们总结出一个通用的模块框架：Versatile Open Input Click Execute Model（通用型打开-输入-鼠标点击运行模型开发模型）VOICE。

此简写同英文单词 vioce寓意为“表达说话声、愿望、呼声的意思，表示让计算机听懂开发者，使用者，框架设计者(Architect，架构师，策划)的心声。”

它是一个通用数据输入与运行框架，包含输入与运行两大功能。
Versatile open input click module. 也可以理解为一个类似脚本化运行的框架，设计原则为“打开-输入-点击”。
通过GUI使用时，它类似于小工具模块。它的开发与使用非常方便，可从资源管理器拖拽输入参数。

---

## 5. 模块的通用框架应该被如何实现

根据 `生物数据分析 GUI 模块的通用共性`，我们实现了一个“模块契约 + 统一加载入口 + 自动发现/插件”的机制：

- **模块契约**：模块需要声明名称、简介、分类、帮助文档等元信息，并提供一个可展示与运行的界面实体。
- **统一加载入口**：主框架通过一个统一方法加载模块，并以一致方式呈现（例如在主界面中打开模块）。
- **自动发现与插件**：内置模块与外部插件可以被自动发现；插件以文件形式分发，用户安装成本低，也便于团队共享工具。

我们基于 eGPS1 的实现，主要采用Java Swing 实现，并采用 Maven 构建系统。后续的开发可以不用 Maven 与 Gradle 构建。

---

## 6. 快速上手：作为使用者，你只需要记住两件事

1) **入口统一**：通过主程序的模块列表（Module Gallery / 模块管理入口）找到并打开模块。
2) **插件易分发**：需要把新方法给同事试用时，优先用插件形式交付（一个文件即可安装/卸载），避免改动主程序。

如果你需要从开发角度开始做第一个模块（或把方法做成插件），建议从教程入口开始。

---

## 7. 总结与展望

eGPS 2.1 的核心不是“堆更多功能”，而是让科研软件在长期迭代中保持秩序：

- 模块化让方法与工具自然分层：每个模块是一个可以被发现、被解释、被安装、被复用的单元。
- 统一的模块规范降低了协作成本：不同人写的模块仍然能以类似方式被使用与维护。
- 插件机制让生态更容易形成：新工具的传播从“重新打包整个软件”降级为“分发一个插件文件”。

对科研场景来说，这类框架的价值最终会体现在：当你反复面对新数据、新格式、新方法和新协作者时，软件仍然能稳定地生长，而不会因为规模扩大而失控。

